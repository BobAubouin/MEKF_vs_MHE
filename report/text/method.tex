In this section, different methods used to estimate the unknown parameters of the PD models are detailed. $BIS_0$ can be measured at before the induction of anesthesia and $E_{max}$ is usually set equal to $BIS_0$. Thus the remaining parameters are $C_{50p}$, $C_{50r}$, and $\gamma$. in this section, $\theta = \begin{pmatrix} C_{50p} & C_{50r} & \gamma \end{pmatrix}$ is used to describe the vector of unknown parameters.
\medskip

The Multi Extended Kalman Filter (MEKF) method select the best vector among a grid in space of the parameters. This discrete choice allow a fast convergence but less precision at the end. The Moving Horizon Estimation (MHE) method uses an extended state formulation to estimate the vector of parameters along with the state in a continuous manner. Thus the method could identify more precisely the parameters but is also more subject to noise and could be slower than MEKF.

\subsection{Multi Extended Kalman Filter}

In order to identify the PD parameters, the MEKF method uses a set of EKF, one for every realization of the vector selected within a grid in the space of the parameters. The grid is designed to reasonably represent the variability of the parameter vector. Next, a vector is chosen using a model-matching criterion. \medskip 

EKF is a state estimation method that relies on the linearization of a non-linear model. If we consider the model given in (\ref{eq:model}) with the non-linear function $f$ parametrized by $\theta$, the estimator using the parameter vector $\theta_i$ is given by:

\begin{flalign*}
&H_i(k) = \left. \frac{\partial f(x, \theta_i)}{\partial x} \right| _{x=\hat{x}_i(k_{|k-1})} \\
&K_i(k) = P_i(k_{|k-1})H_i^\top (k)(H_i(k)P_i(k_{|k-1})H_i^\top (k) + R_2)^{-1} \\
&\hat{x}_i(k_{|k}) = \hat{x}_i(k_{|k-1}) + K_i(k)(y(k) - f(\hat{x}_i(k_{|k-1}),\theta_i )) \\
&P_i(k_{|k}) = P_i(k_{|k-1}) - K_i(k) H_i(k) P_i(k_{|k-1}) \\
&\hat{x}_i(k+1_{|k}) =  A_d \hat{x}_i(k_{|k}) + B_d u(k) \\
&P_i(k+1_{|k}) = A_d P_i(k_{|k})A_d ^\top + R_1
\end{flalign*}

Here the notation $X(k_{1|k_2})$ represents the value of variable X computed at time step $k_1$ based on the knowledge available at $k_2$. The estimated state vector is $\hat{x}$ and $P$ is the covariance matrix. $A_d$ and $B_d$ are the matrix describing the discretized dynamic system (\ref{eq:model}) such that $x(k+1) = A_dx(k) + B_d u(k)$. $R_1$ and $R_2$ are two constant matrices used to respectively characterize the process uncertainties and the measurements noise.
\medskip


The idea is to select the "best" observer at each step time. To do so, the estimation error on the output $e(k) = y(k) - f(x(k|_{k-1}), \theta_i)$ is used to construct a selection criterion for each observer. As in \cite{petriImprovingEstimationPerformance2022} the dynamic of the criterion for the $i^{th}$ observer is given by:

\begin{equation}
\eta_i (k+1) = \eta_i (k) + dt \left(- \nu \eta_i(k) + \lambda_1 |e(k)|^2 + \lambda_2 |K_i(k) e(k)|^2 \right)
\label{eq:criterion_dyn}
\end{equation}

where $\lambda_1, \lambda_2$, and $\nu$ are three positive design parameters and $dt$ the sampling time of the system. The criterion depend both on the output estimation error $e(k)$ and the correction effort of the observer $K_i(k) e(k)$. Equation (\ref{eq:criterion_dyn}) can be discretize with Euler method and the following equation can be deducted:

\begin{equation}
\eta_i(k) = e^{-\nu k dt} + \sum_{j=1}^{k} e^{-\nu(k-j)dt} (\lambda_1 |e(j)|^2 + \lambda_2 |K_i(j) e(j)|^2 )
\end{equation} 

$\eta_i$ can be seen as a cost and the idea is to select the observer with the minimal cost at each step time. The index of the actually selected observer is denoted $i^*$.

\medskip
Because this solution could produce too much switching between the observers, the parameter $\epsilon \in ]0,1]$ is introduced and the switching is done at time step $k$ only if it exists $i\neq i^*$ such that $\eta_i(k)<\epsilon \eta_{i^*}$.
\medskip

To initialized the criterion of each observer, the distribution of the parameters can be taken into account. Particularly, considering the $\mathcal{C}_i$ the subset of the parameter space such that $\theta_i$ is the closer grid point to every point in $\mathcal{C}_i$ the criterion can be initialized by:

\begin{equation}
\eta_i(0) = \frac{\alpha}{p(\theta \in \mathcal{C}_i)}
\end{equation}

where $\alpha >0$ is a design parameter.



\subsection{Moving Horizon Estimation}

\subsection{Metrics for the comparison}